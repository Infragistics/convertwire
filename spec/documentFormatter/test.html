<!doctype html>
<html>
	<head>
		<script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
	</head>
	<body>
		<div id="docX-root">
<!-- -->
			<pre>
				<span style="hs-build-flags: WinPhone">winphone</span>
			</pre>
			<pre>
				<span style="hs-build-flags: WPF">WPF</span>
			</pre>
			<pre>
				<span style="hs-build-flags: WinPhone">winphone</span>
				<span style="hs-build-flags: WinPhone">winphone</span>
				<span style="hs-build-flags: SL,WPF,WinPhone,WinRT">sl, wpf, winphone, winrt</span>
			</pre>
			<pre>
				<span style="hs-build-flags: XAMARIN">xam</span>
				<span style="hs-build-flags: SL,WPF,WinPhone,WinRT">sl, wpf, winphone, winrt</span>
			</pre -->
<!-- -->
<!--
			
<div id="Example_VB" class="LanguageSpecific" style="DISPLAY: block">
<p><span class="lang"><b>In Visual Basic:</b></span></p><pre>
<code class="code"><span class="blue">Dim</span> data <span class="blue">As</span> <span class="blue">New</span> FinancialDataSample()
<span class="blue">Dim</span> yAxis <span class="blue">As</span> <span class="blue">New</span> NumericYAxis()
<span class="blue">Dim</span> xAxis <span class="blue">As</span> <span class="blue">New</span> CategoryXAxis()
<span class="hs-buildflag-markup" style="hs-build-flags: WINFORMS">xAxis.DataSource = data</span>
<span class="hs-buildflag-markup" style="hs-build-flags: XAML">xAxis.ItemsSource = data</span>
<span class="hs-buildflag-markup" style="hs-build-flags: XAM_XF_EX">xAxis.Label = <span class="string">&quot;{Date}&quot;</span></span>
<span class="hs-buildflag-markup" style="hs-build-flags: XAMARIN,WINFORMS">xAxis.Label = <span class="string">&quot;Date&quot;</span></span>

<span class="blue">Dim</span> series <span class="blue">As</span> <span class="blue">New</span> PositiveVolumeIndexIndicator()
<span class="hs-buildflag-markup" style="hs-build-flags: WINFORMS">series.DataSource = data</span>
<span class="hs-buildflag-markup" style="hs-build-flags: XAML">series.ItemsSource = data</span>
series.OpenMemberPath = <span class="string">&quot;Open&quot;</span>
series.HighMemberPath = <span class="string">&quot;High&quot;</span>
series.LowMemberPath = <span class="string">&quot;Low&quot;</span>
series.CloseMemberPath = <span class="string">&quot;Close&quot;</span>
series.VolumeMemberPath = <span class="string">&quot;Volume&quot;</span>
series.XAxis = xAxis
series.YAxis = yAxis
 
<span class="blue"><span class="blue">Me</span><font color="black" face="Courier New">.DataChart.Axes.Add(xAxis)
</font><span class="blue">Me</span><font color="black" face="Courier New">.DataChart.Axes.Add(yAxis)
</font>Me</span>.DataChart.Series.Add(series) </code>
</pre></div>
<!-- -->
<!-- 

<pre>
<span style="hs-build-flags: WINFORMS">WINFORMS</span>
<span style="hs-build-flags: DROID_EX">DROID_EX</span>
<span style="hs-build-flags: XAML">XAML</span>
<span style="hs-build-flags: SL">SL</span>
<span style="hs-build-flags: WINPHONE">WINPHONE</span>
<span style="hs-build-flags: WINRT">WINRT</span>
<span style="hs-build-flags: WPF">WPF</span>
<span style="hs-build-flags: XAMARIN">XAMARIN</span>
<span style="hs-build-flags: XAM_XF_EX">XAM_XF_EX</span>
<span style="hs-build-flags: XAMARIN,WINFORMS">XAMARIN,WINFORMS</span>
<span style="hs-build-flags: SL,WPF">SL,WPF</span>
</pre>
-->

		</div>
		<script>
			
			var formatter = {
				
				XAM_XF_EX: ['sl','wpf','winrt','winphone'],
				DROID_EX: ['sl','wpf','winphone','winrt','xamarin','winforms'],
				XAML: ['sl','wpf','winphone','winrt','xamarin'],
				
				getUniqueBuildFlags: function($PRE){
					var flags = [], uniqueFlags, $flagContainers;
					
					$flagContainers = $PRE.find('[style^="hs-build-flags"]');
					
					$flagContainers.each(function(){
						var style;
						
						style = $(this).attr('style').toLowerCase();      
						elementFlags = style.replace(/hs-build-flags: /, '').split(','); 
						
						elementFlags.forEach(function(flag){
							if(flag === 'xam_xf_ex'){
								flags = flags.concat(formatter.XAM_XF_EX);
							} else if(flag === 'droid_ex'){
								flags = flags.concat(formatter.DROID_EX);
							} else if(flag === 'xaml'){
								flags = flags.concat(formatter.XAML);
							} else {
								flags.push(flag);
							}
						});
					});
					
					uniqueFlags = _.unique(flags);
					
					return uniqueFlags;
				},
				
				splitSourceBasedOnBuildFlags: function($PRE, flags){
					
					var groupCount = 0;
					
					flags.forEach(function(flag){
						var $newPRE, $flaggedElements;
						
						$newPRE = $PRE.clone();
						$newPRE.attr('style', 'hs-build-flags: ' + flag.toUpperCase());
						
						$flaggedElements = $newPRE.find('[style^="hs-build-flags"]');
						
						$flaggedElements.each(function(){
							var $flaggedElement, containsFlagToRemove;
							
							$flaggedElement = $(this);
												
							containsFlagToRemove = formatter.hasFlagToRemove($flaggedElement, flag);
							
							if(containsFlagToRemove){
								$flaggedElement.remove();
							}
							
							if(formatter.isFlagGroup($flaggedElement)){
								groupCount++
							}
							
						});
						
						$PRE.parent().append('<hr><h1 style="margin-bottom:2px;">' + flag + '</h1>');
						$PRE.parent().append('\n<!--- ' + flag + ' --->\n');								
						$PRE.parent().append($newPRE);
						$PRE.parent().append('\n<!--- /' + flag + ' --->\n');
					});
					
					return {
						hasFlagGroup: groupCount > 0
					}
				},
				
				hasFlagToRemove: function($flaggedElement, currentFlag){
					var result, flags, elementFlags;
					
					result = false;
					currentFlag = currentFlag.toLowerCase();
					elementFlags = formatter.getElementFlags($flaggedElement);
					flags = formatter.readFlags(elementFlags);
					
					if(flags.isFlagGroup){
						if(flags.xamXfEx){
							result = !_.contains(formatter.XAM_XF_EX, currentFlag);
						} else if(flags.droidEx){
							result = !_.contains(formatter.DROID_EX, currentFlag);
						} else if(flags.xaml){
							result = !_.contains(formatter.XAML, currentFlag);							
						}
					} else {
						result = !_.contains(elementFlags, currentFlag);
					}
					
					return result;
				},
				
				isFlagGroup: function($flagedElement){
					var elementFlags = formatter.getElementFlags($flagedElement);
					var flags = formatter.readFlags(elementFlags);
					flags.isFlagGroup;
				},
				
				getElementFlags: function($flaggedElement){
					var style = $flaggedElement.attr('style').toLowerCase();
					var elementFlags = style.replace(/hs-build-flags: /, '').toLowerCase().split(',');
					return elementFlags;
				},
				
				readFlags: function(elementFlags) {
														
					var flags = {
						xamXfEx : _.contains(elementFlags, 'xam_xf_ex'),
						droidEx : _.contains(elementFlags, 'droid_ex'),
						xaml : _.contains(elementFlags, 'xaml')
					};
					
					flags.isFlagGroup = flags.xamXfEx || flags.droidEx || flags.xaml;
					
					return flags;
				}
			};
			
			$(function(){
				var $PREs;
				
				$PREs = $('pre');
				
				$PREs.each(function(){
					var $PRE, uniqueFlags;
					
					$PRE = $(this);
					
					if($PRE.attr('id') === 'metadata'){
						return;
					}
					
					uniqueFlags = formatter.getUniqueBuildFlags($PRE);
					var sourceInfo = formatter.splitSourceBasedOnBuildFlags($PRE, uniqueFlags);
					
					if(sourceInfo.hasFlagGroup){
						$PRE.remove();
					} else {
						$PRE.find('[style^="hs-build-flags"]').remove();
					}
				});
			});
		</script>
	</body>

</html>